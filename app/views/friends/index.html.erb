<div class="container mt-4">
  <h2>My Friends</h2>

  <%# Add this new section for finding friends %>
  <div class="mb-4">
    <h3>Find Friends</h3>
    <%= form_with url: users_path, method: :get, class: "d-flex" do |f| %>
      <%= f.text_field :q, 
                       class: "form-control me-2", 
                       placeholder: "Search by email",
                       value: params[:q] %>
      <%= f.submit "Search", class: "btn btn-outline-primary" %>
    <% end %>

    <% if @users_to_add.present? %>
      <ul class="list-group mt-3">
        <% @users_to_add.each do |user| %>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <span><%= user.email_address %></span>
            <% if current_user.pending_sent_requests.exists?(friend: user) %>
              <span class="badge bg-secondary">Request Pending</span>
            <% else %>
              <%= button_to "Send Friend Request", 
                          user_friendships_path(user), 
                          class: "btn btn-sm btn-primary" %>
            <% end %>
          </li>
        <% end %>
      </ul>
    <% end %>
  </div>

  <%# Existing friends list code remains the same %>
  <h3>Current Friends</h3>
  <% if @friends.any? %>
    <ul class="list-group">
      <% @friends.each do |friend| %>
        <li class="list-group-item d-flex justify-content-between align-items-center" id="friend-<%= friend.id %>">
          <span><%= friend.email_address %></span>
          <div>
            <%= link_to "View Profile", user_path(friend), class: "btn btn-sm btn-primary" %>
            <%= button_to "Remove Friend", 
                       friendship_path(current_user.friendships.find_by(friend: friend)), 
                       method: :delete,
                       class: "btn btn-sm btn-danger" %>
          </div>
        </li>
      <% end %>
    </ul>
  <% else %>
    <p>You don't have any friends yet.</p>
  <% end %>
</div>
<li class="nav-item dropdown">
  <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
    <%= current_user.email_address %>
  </a>
  <div class="dropdown-menu dropdown-menu-end">
    <%= link_to "Profile", edit_profile_path, class: "dropdown-item" %>
    <%= button_to "Sign Out", logout_path, method: :delete, class: "dropdown-item" %>
  </div>
</li>